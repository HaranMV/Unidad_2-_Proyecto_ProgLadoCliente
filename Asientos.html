<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seleccionar Asientos</title>
    <link rel="stylesheet" href="Styles.css">
</head>
<body>
    <header>
        <h1>Selección de Asientos</h1>
        <p class="subtitulo">Elige tus asientos para disfrutar la función</p>
    </header>

    <main>
        <section class="info-pelicula" id="infopelicula">
                
        </section>

        <section class="seleccion-asientos">
            <h3>Selecciona tus asientos</h3>

            
            <div class="pantalla">Pantalla</div>

            <label class="checkbox">
                <input type="checkbox" id="filtroAsietnosLibres">
                  Mostrar solo asientos libres
            </label>

            <div class="contenedor-asientos" id="contenedorAsientos">
                                                
            </div>

            
            <div class="botones-Asietnos">
                <button class="btn volver" id="btnVolver">volver al catálogo</button>
                 <button class="btn confirmar" id="abrirModalConfirmar">Confirmar reserva</button>
            </div>

           
            <div id="mostrarModal" class="DivModal">
        
              <form id="modalReserva" class="modal">
                <h2>Confirmar Reservación</h2>

                <p><strong>Asientos seleccionados:</strong> <span id="listaAsientos"></span></p>
                <p><strong>Total:</strong> $<span id="totalPago"></span> MXN</p>

                <label for="fecha">
                Fecha de función:
                </label>
                <input type="date" id="fecha" required>

                
                <button type="button" id="btnCerrarModal" class="btnCancelar">Cancelar</button>
                <button type="submit" class="btnConfirmar" id="btnConfirmarReserva">Confirmar</button>
                
              </form>

            </div>


        </section>
    </main>

     <footer>
        <p>&copy; Developed by Alfredo Haran Mata Villa</p>
    </footer>

    <script>
        const idSeleccionado = localStorage.getItem("peliculaSeleccionada");        
        const peliculaInfo = document.getElementById("infopelicula");
        let asientos = [];
        

          const peliculas = [
            {
                id:1,
                nombre: "Avengers Endgame",
                duracion: "3h 2m",
                horario: "7:00 pm",
                sala: "1",
                imagen: "imgs/Avengers.jpeg"
            },
            {
                id: 2,
                nombre: "Joker",
                duracion: "2h 28m",
                horario: "9:00 pm",
                sala:"2",
                imagen: "imgs/Joker.jpg"           
            },
            {
                id:3,
                nombre: "Aniquilación",
                duracion: "2h 18min",
                horario: "10:00 pm",
                sala:"3",
                imagen: "imgs/Aniquilacion.jpg"
            },
            {
                id:4,
                nombre: "Godzilla x Kong: El Nuevo Imperio",
                duracion: "1h 54min",
                horario: "5:00 pm",
                sala:"4",
                imagen: "imgs/Godzilla.jpg"
            },
              {
                id:5,
                nombre: "Guerra Mundial Z",
                duracion: "1h 56min",
                horario: "11:00 pm",
                sala:"5",
                imagen: "imgs/wwz.jpg"
            }
            
        ];

        const buscarPelicula = peliculas.find(p => p.id == idSeleccionado);

        if(buscarPelicula){
             peliculaInfo.innerHTML = `
                  <img src="${buscarPelicula.imagen}">
                <div class="detalles">
                   <h2>${buscarPelicula.nombre}</h2>
                   <p>Duración: ${buscarPelicula.duracion}</p>
                   <p>Horario: ${buscarPelicula.horario}</p>
                   <p>Sala: ${buscarPelicula.sala}</p>
                </div>
    `;
        }

        //Generar los asientos
        const filas = 5;
        const asientosPorFila = 15;
        const ocupados = ["A3", "A8", "B4", "C3", "D7", "E10"];
        const contenedorAsientos = document.getElementById("contenedorAsientos");
        const letraFila = i => String.fromCharCode(65 + i);

        for(let i = 0; i<filas; i++){
            const divFila = document.createElement("div");
            divFila.classList.add("fila");

            const letra = letraFila(i);

            for(let a = 1; a <= asientosPorFila; a++){
                const id = `${letra}${a}`;
                const asiento = document.createElement("span");
                asiento.classList.add("asiento");
                asiento.setAttribute("data-id", id);
                asiento.textContent = id;
                if(ocupados.includes(id)){
                    asiento.classList.add("ocupado")
                }
                divFila.appendChild(asiento);
            }
            
            contenedorAsientos.appendChild(divFila);

            
        }
       

        //Seleccionar asientos
        let asientosSeleccionados = [];
        const maxAsientos = 10;
        document.addEventListener("click", function(e){
            if(e.target.classList.contains("asiento") && !e.target.classList.contains("ocupado")){
                
                 const asientoID = e.target.dataset.id;

                 if(asientosSeleccionados.includes(asientoID)){
                     asientosSeleccionados = asientosSeleccionados.filter(a => a !== asientoID);
                     e.target.classList.remove("seleccionado");
                 }
                 else{
                    if (asientosSeleccionados.length >= maxAsientos) {
                    alert("Solo puedes seleccionar un máximo de 10 asientos.");
                    return;
                  }
                   asientosSeleccionados.push(asientoID);
                 e.target.classList.add("seleccionado");
                 }
                
            }
        });
        
        //Abrir y cerrar modales
        const btnAbrirModal = document.getElementById("abrirModalConfirmar");
        const btnCerrarModal= document.getElementById("btnCerrarModal");
        const modal = document.getElementById("mostrarModal");
        const totalPago = document.getElementById("totalPago");
        const listaAsientos = document.getElementById("listaAsientos")
        const precioBoleto = 50;
        const btnVolver = document.getElementById("btnVolver");



        btnAbrirModal.addEventListener("click", function(){                          
            if(asientosSeleccionados  == 0){
                alert("No ha saleccionado ningun asiento"); 
                return;
            }
            listaAsientos.textContent = asientosSeleccionados.join(", ");
            totalPago.textContent = asientosSeleccionados.length * precioBoleto;
            modal.style.display = "flex"
        });

        btnCerrarModal.addEventListener("click", function(){
            modal.style.display = "none"
        });
        
        btnVolver.addEventListener("click", function(){
            window.location.href = "index.html";
        });
        const fechaInput = document.getElementById("fecha");
        fechaInput.min = new Date().toISOString().split("T")[0];


        //REservar asientos
       let asientosOcupados = JSON.parse(localStorage.getItem("asientosOcupados_" + idSeleccionado)) || [];

       document.getElementById("modalReserva").addEventListener("submit", function(e){
         e.preventDefault();
    
    asientosOcupados.push(...asientosSeleccionados);
    localStorage.setItem("asientosOcupados_" + idSeleccionado, JSON.stringify(asientosOcupados));
    
    asientosSeleccionados.forEach(id => {
        const asiento = document.querySelector(`[data-id="${id}"]`);
        asiento.classList.remove("seleccionado");
        asiento.classList.add("ocupado");
    });
    
    const fechaReserva = document.getElementById("fecha").value;
    
    const reserva = {
        pelicula: idSeleccionado,
        nombre: buscarPelicula.nombre,
        asientos: [...asientosSeleccionados],
        fecha: fechaReserva
    };

    let reservas = JSON.parse(localStorage.getItem("reservas")) || [];
    reservas.push(reserva);
    localStorage.setItem("reservas", JSON.stringify(reservas));

    
    asientosSeleccionados = [];
    
    document.getElementById("mostrarModal").style.display = "none";

    alert("¡Reservación confirmada!");

    window.location.reload();
});

//asientos ocupados al cargar la página
asientosOcupados.forEach(id => {
    const asiento = document.querySelector(`[data-id="${id}"]`);
    if (asiento) asiento.classList.add("ocupado");
});

       //Filtro
       const filtroAsietnosLibres = document.getElementById("filtroAsietnosLibres")

       filtroAsietnosLibres.addEventListener("change", function(){
        const asientos = document.querySelectorAll(".asiento");

        asientos.forEach(a => { 
            if(filtroAsietnosLibres.checked){
                if(a.classList.contains("ocupado")){
                    a.style.display = "none";
                }
                else{
                    a.style.display = "flex";
                }
            }
            else{
                a.style.display = "flex"
            }
        });
       });

    </script>
</body>
</html>
